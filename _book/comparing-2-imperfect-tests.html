<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Comparing 2 imperfect tests | Bayesian latent class models for prevalence estimation and diagnostic test evaluation</title>
  <meta name="description" content="Chapitre 5" />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Comparing 2 imperfect tests | Bayesian latent class models for prevalence estimation and diagnostic test evaluation" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Chapitre 5" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Comparing 2 imperfect tests | Bayesian latent class models for prevalence estimation and diagnostic test evaluation" />
  
  <meta name="twitter:description" content="Chapitre 5" />
  

<meta name="author" content="Simon Dufour and Juan Carlos Arango Sabogal" />


<meta name="date" content="2022-05-04" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="exercise-1---proportions.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Bayesian latent class models</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> About this document</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#some-notation"><i class="fa fa-check"></i><b>1.1</b> Some notation</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="distributions.html"><a href="distributions.html"><i class="fa fa-check"></i><b>2</b> Distributions</a>
<ul>
<li class="chapter" data-level="2.1" data-path="distributions.html"><a href="distributions.html#prior-distributions"><i class="fa fa-check"></i><b>2.1</b> Prior distributions</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="distributions.html"><a href="distributions.html#normal-distribution"><i class="fa fa-check"></i><b>2.1.1</b> Normal distribution</a></li>
<li class="chapter" data-level="2.1.2" data-path="distributions.html"><a href="distributions.html#uniform-distribution"><i class="fa fa-check"></i><b>2.1.2</b> Uniform distribution</a></li>
<li class="chapter" data-level="2.1.3" data-path="distributions.html"><a href="distributions.html#beta-distribution"><i class="fa fa-check"></i><b>2.1.3</b> Beta distribution</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="distributions.html"><a href="distributions.html#distributions-for-likelihood-functions"><i class="fa fa-check"></i><b>2.2</b> Distributions for likelihood functions</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="distributions.html"><a href="distributions.html#binomial-distribution"><i class="fa fa-check"></i><b>2.2.1</b> Binomial distribution</a></li>
<li class="chapter" data-level="2.2.2" data-path="distributions.html"><a href="distributions.html#multinomial-distribution"><i class="fa fa-check"></i><b>2.2.2</b> Multinomial distribution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="running-bayesian-models.html"><a href="running-bayesian-models.html"><i class="fa fa-check"></i><b>3</b> Running Bayesian models</a>
<ul>
<li class="chapter" data-level="3.1" data-path="running-bayesian-models.html"><a href="running-bayesian-models.html#the-data"><i class="fa fa-check"></i><b>3.1</b> The data</a></li>
<li class="chapter" data-level="3.2" data-path="running-bayesian-models.html"><a href="running-bayesian-models.html#the-model"><i class="fa fa-check"></i><b>3.2</b> The model</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="running-bayesian-models.html"><a href="running-bayesian-models.html#the-likelihood-function"><i class="fa fa-check"></i><b>3.2.1</b> The likelihood function</a></li>
<li class="chapter" data-level="3.2.2" data-path="running-bayesian-models.html"><a href="running-bayesian-models.html#priors-for-unkown-parameters"><i class="fa fa-check"></i><b>3.2.2</b> Priors for unkown parameters</a></li>
<li class="chapter" data-level="3.2.3" data-path="running-bayesian-models.html"><a href="running-bayesian-models.html#creating-the-jags-model"><i class="fa fa-check"></i><b>3.2.3</b> Creating the JAGS model</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="running-bayesian-models.html"><a href="running-bayesian-models.html#generating-initial-values"><i class="fa fa-check"></i><b>3.3</b> Generating initial values</a></li>
<li class="chapter" data-level="3.4" data-path="running-bayesian-models.html"><a href="running-bayesian-models.html#running-a-model-in-jags"><i class="fa fa-check"></i><b>3.4</b> Running a model in JAGS</a></li>
<li class="chapter" data-level="3.5" data-path="running-bayesian-models.html"><a href="running-bayesian-models.html#model-diagnostic"><i class="fa fa-check"></i><b>3.5</b> Model diagnostic</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="running-bayesian-models.html"><a href="running-bayesian-models.html#convergence-and-burn-in"><i class="fa fa-check"></i><b>3.5.1</b> Convergence and burn-in</a></li>
<li class="chapter" data-level="3.5.2" data-path="running-bayesian-models.html"><a href="running-bayesian-models.html#number-of-iterations"><i class="fa fa-check"></i><b>3.5.2</b> Number of iterations</a></li>
<li class="chapter" data-level="3.5.3" data-path="running-bayesian-models.html"><a href="running-bayesian-models.html#auto-correlation"><i class="fa fa-check"></i><b>3.5.3</b> Auto-correlation</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="running-bayesian-models.html"><a href="running-bayesian-models.html#getting-our-estimates"><i class="fa fa-check"></i><b>3.6</b> Getting our estimates</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="exercise-1---proportions.html"><a href="exercise-1---proportions.html"><i class="fa fa-check"></i><b>4</b> Exercise 1 - Proportions</a>
<ul>
<li class="chapter" data-level="4.1" data-path="exercise-1---proportions.html"><a href="exercise-1---proportions.html#data"><i class="fa fa-check"></i><b>4.1</b> Data</a></li>
<li class="chapter" data-level="4.2" data-path="exercise-1---proportions.html"><a href="exercise-1---proportions.html#questions"><i class="fa fa-check"></i><b>4.2</b> Questions</a></li>
<li class="chapter" data-level="4.3" data-path="exercise-1---proportions.html"><a href="exercise-1---proportions.html#answers"><i class="fa fa-check"></i><b>4.3</b> Answers</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="comparing-2-imperfect-tests.html"><a href="comparing-2-imperfect-tests.html"><i class="fa fa-check"></i><b>5</b> Comparing 2 imperfect tests</a>
<ul>
<li class="chapter" data-level="5.1" data-path="comparing-2-imperfect-tests.html"><a href="comparing-2-imperfect-tests.html#lcm---conditional-independence"><i class="fa fa-check"></i><b>5.1</b> LCM - Conditional independence</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Bayesian latent class models for prevalence estimation and diagnostic test evaluation</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="comparing-2-imperfect-tests" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">Chapter 5</span> Comparing 2 imperfect tests<a href="comparing-2-imperfect-tests.html#comparing-2-imperfect-tests" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>When using two imperfect diagnostic tests on a same population, we will have to use a Bayesian latent class model (<strong>LCM</strong>) to estimate the true disease prevalence, and the sensitivity and specificity of both diagnostic tests. Two different approaches could be used. The simplest approach would be to consider that the two diagnostic tests are conditionally independents. Conditional independence can be defined as:</p>
<p><em>Two tests are conditionally independent when the sensitivity (or specificity) of one test does not depend on whether the results of another test are positive or negative among infected (or non-infected) individuals.</em> <a href="https://doi.org/10.20506/rst.40.1.3224">Cheung et al., 2021</a></p>
<p>In many situations, however, we will use two diagnostic tests that make use of the same biological reactions. For instance, if I have an ELISA test that measures antibodies against a given pathogen in blood and another test that is also measuring antibodies, but in milk. In such case, it would be difficult to pretend that:</p>
<p><em>The sensitivity (or specificity) of the milk test does not depend on whether the results of the blood test are positive or negative among infected (or non-infected) individuals.</em></p>
<p>In such case, it would be better to consider a LCM where conditional dependence between tests is possible. Note that, even for tests that make use of very different biological processes, it is rather difficult (or, actually, often impossible) to “demonstrate” conditional independence between tests… So, if doable, allowing for a potential conditional dependence between tests would be more robust.</p>
<div id="lcm---conditional-independence" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> LCM - Conditional independence<a href="comparing-2-imperfect-tests.html#lcm---conditional-independence" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let first consider two conditionally independent diagnostic tests. When two tests are conditionally independent, then, obtaining a given combination of results to Test A and Test B, as function of the true disease status and of the accuracy of each test, can be described as illustrated below:</p>
<div class="figure">
<img src="Figures/cond_indep.png" alt="" />
<p class="caption">Illustration of the different potential results when applying two conditionally independent tests in a population.</p>
</div>
<p>With that illustration, we can deduce that the probability of testing positive to both tests is:</p>
<p><span class="math inline">\(P(TestA+TestB+) = P*SeA*SeB + (1-P)*(1-SpA)*(1-SpB)\)</span></p>
<p>Or, putted in words, it is the probability of being a truly diseased individual and of being identified as such by both tests (<span class="math inline">\(P*SeA*SeB\)</span>), plus the probability of being a healthy individual and being misdiagnosed as diseased by both tests (<span class="math inline">\((1-P)*(1-SpA)*(1-SpB)\)</span>). If we extend this reasoning to all tests combination possibilities, we get:</p>
<p><span class="math inline">\(P(TestA+TestB+) = P*SeA*SeB + (1-P)*(1-SpA)*(1-SpB)\)</span><br />
<span class="math inline">\(P(TestA+TestB-) = P*SeA*(1-SeB) + (1-P)*(1-SpA)*(SpB)\)</span><br />
<span class="math inline">\(P(TestA-TestB+) = P*(1-SeA)*SeB + (1-P)*(SpA)*(1-SpB)\)</span><br />
<span class="math inline">\(P(TestA-TestB-) = P*(1-SeA(*(1-SeB) + (1-P)*(SpA)*(SpB)\)</span></p>
<p>When conducting two diagnostic tests on a given population, the data generated can be presented very simply as the number of individuals in each cells of the 2x2 table presenting the cross-classified results of the two tests:</p>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-30">Table 5.1: </span>Cross-classified results from two diagnostic tests
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
Test A+
</th>
<th style="text-align:left;">
Test A-
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Test B+
</td>
<td style="text-align:left;">
n1
</td>
<td style="text-align:left;">
n3
</td>
</tr>
<tr>
<td style="text-align:left;">
Test B-
</td>
<td style="text-align:left;">
n2
</td>
<td style="text-align:left;">
n4
</td>
</tr>
</tbody>
</table>
<p>Thus, the likelihood function that could link the observed data (n1, n2, n3, n4) to the unknown parameters (<em>P</em>, <em>SeA</em>, <em>SeB</em>, <em>SpA</em>, <em>SpB</em>) could be defined as follow, using a multinomial distribution:</p>
<p><span class="math inline">\(n[1:4] \sim dmulti(P[1:4], n)\)</span></p>
<p><span class="math inline">\(P1 = P*SeA*SeB + (1-P)*(1-SpA)*(1-SpB)\)</span><br />
<span class="math inline">\(P2 = P*SeA*(1-SeB) + (1-P)*(1-SpA)*(SpB)\)</span><br />
<span class="math inline">\(P3 = P*(1-SeA)*SeB + (1-P)*(SpA)*(1-SpB)\)</span><br />
<span class="math inline">\(P3 = P*(1-SeA(*(1-SeB) + (1-P)*(SpA)*(SpB)\)</span></p>
<p>Again, if we put that in words, the number of individual in cell <em>n1</em> (i.e., TestA+ and TestB+) is determined by the number of individuals tested (<em>n</em>) and the probability (<em>P1</em>) of falling in that cell, the latter itself depends on the true prevalence of disease in the population, and on each of the two tests sensitivity and specificity. We can use similar reasoning for <em>n2</em>, <em>n3</em>, and <em>n4</em>. Finally, the multinomial distribution would further imposed that the four probabilities (<em>P1</em>, <em>P2</em>, <em>P3</em>, and <em>P4</em>) have to sum up to 1.0 (i.e., 100%).</p>
<p>In such a model, we will have five unknown parameters to estimate (<em>P</em>, <em>SeA</em>, <em>SeB</em>, <em>SpA</em>, <em>SpB</em>), but only four equations. Thus, the model will be “non-identifiable”, and we will need to provide informative priors on, at least, two parameters. Often, we will provide priors on the Se and Sp of one of the tests, and/or on the disease prevalence.</p>
<p>To run such a model, we simply need to provide a dataset where <em>n1</em>, <em>n2</em>, <em>n3</em>, and <em>n4</em> are listed (in that order).</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="comparing-2-imperfect-tests.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">#n is of the form : (TestA pos and TestB pos), (TestA pos and TestB neg), (TestA neg and TestB pos), then (TestA neg and TestB neg)</span></span>
<span id="cb39-2"><a href="comparing-2-imperfect-tests.html#cb39-2" aria-hidden="true" tabindex="-1"></a>datalist <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">n=</span><span class="fu">c</span>(<span class="dv">138</span>,<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">113</span>))</span></code></pre></div>
<p>In JAGS language we could write the model as follow. Note that I have made use below of the <code>paste0()</code> function to produce a model in which you could modify the tests “labels”. You could thus use this generic JAGS model with various diagnostic tests, and still obtain “meaningful” outputs.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="comparing-2-imperfect-tests.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">#I could first create labels for TestA and TestB</span></span>
<span id="cb40-2"><a href="comparing-2-imperfect-tests.html#cb40-2" aria-hidden="true" tabindex="-1"></a>TestA <span class="ot">&lt;-</span> <span class="st">&quot;US&quot;</span></span>
<span id="cb40-3"><a href="comparing-2-imperfect-tests.html#cb40-3" aria-hidden="true" tabindex="-1"></a>TestB <span class="ot">&lt;-</span> <span class="st">&quot;PAG&quot;</span></span>
<span id="cb40-4"><a href="comparing-2-imperfect-tests.html#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="comparing-2-imperfect-tests.html#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Provide information for the prior distributions (all beta distributions) for the 5 unknown parameters </span></span>
<span id="cb40-6"><a href="comparing-2-imperfect-tests.html#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Below, I have used informative priors for Prev, and Se and Sp of Test A. The values used are not seldom important at this stage.</span></span>
<span id="cb40-7"><a href="comparing-2-imperfect-tests.html#cb40-7" aria-hidden="true" tabindex="-1"></a>Prev.shapea <span class="ot">&lt;-</span> <span class="fl">4.2</span>         <span class="co">#a shape parameter for Prev    </span></span>
<span id="cb40-8"><a href="comparing-2-imperfect-tests.html#cb40-8" aria-hidden="true" tabindex="-1"></a>Prev.shapeb <span class="ot">&lt;-</span> <span class="fl">5.4</span>         <span class="co">#b shape parameter for Prev</span></span>
<span id="cb40-9"><a href="comparing-2-imperfect-tests.html#cb40-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-10"><a href="comparing-2-imperfect-tests.html#cb40-10" aria-hidden="true" tabindex="-1"></a>Se.TestA.shapea <span class="ot">&lt;-</span> <span class="dv">131</span>     <span class="co">#a shape parameter for Se of TestA</span></span>
<span id="cb40-11"><a href="comparing-2-imperfect-tests.html#cb40-11" aria-hidden="true" tabindex="-1"></a>Se.TestA.shapeb <span class="ot">&lt;-</span> <span class="dv">15</span>     <span class="co">#b shape parameter for Se of TestA</span></span>
<span id="cb40-12"><a href="comparing-2-imperfect-tests.html#cb40-12" aria-hidden="true" tabindex="-1"></a>Sp.TestA.shapea <span class="ot">&lt;-</span> <span class="dv">100</span>     <span class="co">#a shape parameter for Sp of TestA</span></span>
<span id="cb40-13"><a href="comparing-2-imperfect-tests.html#cb40-13" aria-hidden="true" tabindex="-1"></a>Sp.TestA.shapeb <span class="ot">&lt;-</span> <span class="dv">6</span>     <span class="co">#b shape parameter for Sp of TestA</span></span>
<span id="cb40-14"><a href="comparing-2-imperfect-tests.html#cb40-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-15"><a href="comparing-2-imperfect-tests.html#cb40-15" aria-hidden="true" tabindex="-1"></a>Se.TestB.shapea <span class="ot">&lt;-</span> <span class="dv">1</span>     <span class="co">#a shape parameter for Se of TestB</span></span>
<span id="cb40-16"><a href="comparing-2-imperfect-tests.html#cb40-16" aria-hidden="true" tabindex="-1"></a>Se.TestB.shapeb <span class="ot">&lt;-</span> <span class="dv">1</span>     <span class="co">#b shape parameter for Se of TestB</span></span>
<span id="cb40-17"><a href="comparing-2-imperfect-tests.html#cb40-17" aria-hidden="true" tabindex="-1"></a>Sp.TestB.shapea <span class="ot">&lt;-</span> <span class="dv">1</span>     <span class="co">#a shape parameter for Sp of TestB</span></span>
<span id="cb40-18"><a href="comparing-2-imperfect-tests.html#cb40-18" aria-hidden="true" tabindex="-1"></a>Sp.TestB.shapeb <span class="ot">&lt;-</span> <span class="dv">1</span>     <span class="co">#b shape parameter for Sp of TestB</span></span>
<span id="cb40-19"><a href="comparing-2-imperfect-tests.html#cb40-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-20"><a href="comparing-2-imperfect-tests.html#cb40-20" aria-hidden="true" tabindex="-1"></a><span class="co">#I will also need the total number of individuals tested (n)</span></span>
<span id="cb40-21"><a href="comparing-2-imperfect-tests.html#cb40-21" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">sapply</span>(datalist, sum)</span></code></pre></div>
<p>With that, I have everything that is needed to write the JAGS model.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="comparing-2-imperfect-tests.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Create the JAGS text file</span></span>
<span id="cb41-2"><a href="comparing-2-imperfect-tests.html#cb41-2" aria-hidden="true" tabindex="-1"></a>model_2tests_1pop_indep <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;model{</span></span>
<span id="cb41-3"><a href="comparing-2-imperfect-tests.html#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="comparing-2-imperfect-tests.html#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="st">#=== LIKELIHOOD ===#</span></span>
<span id="cb41-5"><a href="comparing-2-imperfect-tests.html#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="comparing-2-imperfect-tests.html#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="st">  n[1:4] ~ dmulti(p[1:4], &quot;</span>,n,<span class="st">&quot;)</span></span>
<span id="cb41-7"><a href="comparing-2-imperfect-tests.html#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="comparing-2-imperfect-tests.html#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="st">  p[1] &lt;- Prev*(Se_&quot;</span>, TestA, <span class="st">&quot;*Se_&quot;</span>, TestB, <span class="st">&quot;) + (1-Prev)*((1-Sp_&quot;</span>, TestA, <span class="st">&quot;)*(1-Sp_&quot;</span>, TestB, <span class="st">&quot;))</span></span>
<span id="cb41-9"><a href="comparing-2-imperfect-tests.html#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="st"> </span></span>
<span id="cb41-10"><a href="comparing-2-imperfect-tests.html#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="st">  p[2] &lt;- Prev*(Se_&quot;</span>, TestA, <span class="st">&quot;*(1-Se_&quot;</span>, TestB, <span class="st">&quot;)) + (1-Prev)*((1-Sp_&quot;</span>, TestA, <span class="st">&quot;)*Sp_&quot;</span>, TestB, <span class="st">&quot;)</span></span>
<span id="cb41-11"><a href="comparing-2-imperfect-tests.html#cb41-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-12"><a href="comparing-2-imperfect-tests.html#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="st">  p[3] &lt;- Prev*((1-Se_&quot;</span>, TestA, <span class="st">&quot;)*Se_&quot;</span>, TestB, <span class="st">&quot;) + (1-Prev)*(Sp_&quot;</span>, TestA, <span class="st">&quot;*(1-Sp_&quot;</span>, TestB, <span class="st">&quot;))</span></span>
<span id="cb41-13"><a href="comparing-2-imperfect-tests.html#cb41-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-14"><a href="comparing-2-imperfect-tests.html#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="st">  p[4] &lt;- Prev*((1-Se_&quot;</span>, TestA, <span class="st">&quot;)*(1-Se_&quot;</span>, TestB, <span class="st">&quot;)) + (1-Prev)*(Sp_&quot;</span>, TestA, <span class="st">&quot;*Sp_&quot;</span>, TestB, <span class="st">&quot;)</span></span>
<span id="cb41-15"><a href="comparing-2-imperfect-tests.html#cb41-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-16"><a href="comparing-2-imperfect-tests.html#cb41-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-17"><a href="comparing-2-imperfect-tests.html#cb41-17" aria-hidden="true" tabindex="-1"></a><span class="st">#=== PRIOR  ===#</span></span>
<span id="cb41-18"><a href="comparing-2-imperfect-tests.html#cb41-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-19"><a href="comparing-2-imperfect-tests.html#cb41-19" aria-hidden="true" tabindex="-1"></a><span class="st">  Prev ~ dbeta(&quot;</span>,Prev.shapea,<span class="st">&quot;, &quot;</span>,Prev.shapeb,<span class="st">&quot;)    ## Prior for Prev</span></span>
<span id="cb41-20"><a href="comparing-2-imperfect-tests.html#cb41-20" aria-hidden="true" tabindex="-1"></a><span class="st">  Se_&quot;</span>, TestA, <span class="st">&quot; ~ dbeta(&quot;</span>,Se.TestA.shapea,<span class="st">&quot;, &quot;</span>,Se.TestA.shapeb,<span class="st">&quot;)  ## Prior for Se of Test A</span></span>
<span id="cb41-21"><a href="comparing-2-imperfect-tests.html#cb41-21" aria-hidden="true" tabindex="-1"></a><span class="st">  Sp_&quot;</span>, TestA, <span class="st">&quot; ~ dbeta(&quot;</span>,Sp.TestA.shapea,<span class="st">&quot;, &quot;</span>,Sp.TestA.shapeb,<span class="st">&quot;)  ## Prior for Sp of Test A</span></span>
<span id="cb41-22"><a href="comparing-2-imperfect-tests.html#cb41-22" aria-hidden="true" tabindex="-1"></a><span class="st">  Se_&quot;</span>, TestB, <span class="st">&quot; ~ dbeta(&quot;</span>,Se.TestB.shapea,<span class="st">&quot;, &quot;</span>,Se.TestB.shapeb,<span class="st">&quot;)  ## Prior for Se of Test B</span></span>
<span id="cb41-23"><a href="comparing-2-imperfect-tests.html#cb41-23" aria-hidden="true" tabindex="-1"></a><span class="st">  Sp_&quot;</span>, TestB, <span class="st">&quot; ~ dbeta(&quot;</span>,Sp.TestB.shapea,<span class="st">&quot;, &quot;</span>,Sp.TestB.shapeb,<span class="st">&quot;)  ## Prior for Sp of Test B</span></span>
<span id="cb41-24"><a href="comparing-2-imperfect-tests.html#cb41-24" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb41-25"><a href="comparing-2-imperfect-tests.html#cb41-25" aria-hidden="true" tabindex="-1"></a><span class="st">}&quot;</span>)</span>
<span id="cb41-26"><a href="comparing-2-imperfect-tests.html#cb41-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-27"><a href="comparing-2-imperfect-tests.html#cb41-27" aria-hidden="true" tabindex="-1"></a><span class="co">#write as a text (.txt) file</span></span>
<span id="cb41-28"><a href="comparing-2-imperfect-tests.html#cb41-28" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(model_2tests_1pop_indep, </span>
<span id="cb41-29"><a href="comparing-2-imperfect-tests.html#cb41-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">file=</span><span class="st">&quot;model_2tests_1pop_indep.txt&quot;</span>, </span>
<span id="cb41-30"><a href="comparing-2-imperfect-tests.html#cb41-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">quote=</span><span class="cn">FALSE</span>, </span>
<span id="cb41-31"><a href="comparing-2-imperfect-tests.html#cb41-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep=</span><span class="st">&quot;&quot;</span>, </span>
<span id="cb41-32"><a href="comparing-2-imperfect-tests.html#cb41-32" aria-hidden="true" tabindex="-1"></a>            <span class="at">row.names=</span><span class="cn">FALSE</span>,</span>
<span id="cb41-33"><a href="comparing-2-imperfect-tests.html#cb41-33" aria-hidden="true" tabindex="-1"></a>             <span class="at">col.names=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p>With this code, you could simply modify the labels for TestA and Test B, and the shape parameters for the prior distributions and the text file with the JAGS model will automatically be updated. Currently, it looks like this:</p>
<div class="figure">
<img src="Figures/model_2tests_1pop_indep.png" alt="" />
<p class="caption">Text file with the model for 2 independent diagnostic tests in 1 single population.</p>
</div>
<p>We will also need to provide a list of initial values (one per Markov chain) for all unknown parameters.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="comparing-2-imperfect-tests.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Initializing values for the parameters Prev, and the Ses and Sps of the two tests for the 3 chains.</span></span>
<span id="cb42-2"><a href="comparing-2-imperfect-tests.html#cb42-2" aria-hidden="true" tabindex="-1"></a>inits <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">list</span>(<span class="at">Prev=</span><span class="fl">0.50</span>,</span>
<span id="cb42-3"><a href="comparing-2-imperfect-tests.html#cb42-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">Se_US=</span><span class="fl">0.90</span>,</span>
<span id="cb42-4"><a href="comparing-2-imperfect-tests.html#cb42-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">Sp_US=</span><span class="fl">0.90</span>,</span>
<span id="cb42-5"><a href="comparing-2-imperfect-tests.html#cb42-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">Se_PAG=</span><span class="fl">0.90</span>,</span>
<span id="cb42-6"><a href="comparing-2-imperfect-tests.html#cb42-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">Sp_PAG=</span><span class="fl">0.90</span>),</span>
<span id="cb42-7"><a href="comparing-2-imperfect-tests.html#cb42-7" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb42-8"><a href="comparing-2-imperfect-tests.html#cb42-8" aria-hidden="true" tabindex="-1"></a>              <span class="fu">list</span>(<span class="at">Prev=</span><span class="fl">0.70</span>,</span>
<span id="cb42-9"><a href="comparing-2-imperfect-tests.html#cb42-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">Se_US=</span><span class="fl">0.10</span>,</span>
<span id="cb42-10"><a href="comparing-2-imperfect-tests.html#cb42-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">Sp_US=</span><span class="fl">0.10</span>,</span>
<span id="cb42-11"><a href="comparing-2-imperfect-tests.html#cb42-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">Se_PAG=</span><span class="fl">0.10</span>,</span>
<span id="cb42-12"><a href="comparing-2-imperfect-tests.html#cb42-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">Sp_PAG=</span><span class="fl">0.10</span>),</span>
<span id="cb42-13"><a href="comparing-2-imperfect-tests.html#cb42-13" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb42-14"><a href="comparing-2-imperfect-tests.html#cb42-14" aria-hidden="true" tabindex="-1"></a>              <span class="fu">list</span>(<span class="at">Prev=</span><span class="fl">0.50</span>,</span>
<span id="cb42-15"><a href="comparing-2-imperfect-tests.html#cb42-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">Se_US=</span><span class="fl">0.50</span>,</span>
<span id="cb42-16"><a href="comparing-2-imperfect-tests.html#cb42-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">Sp_US=</span><span class="fl">0.50</span>,</span>
<span id="cb42-17"><a href="comparing-2-imperfect-tests.html#cb42-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">Se_PAG=</span><span class="fl">0.50</span>,</span>
<span id="cb42-18"><a href="comparing-2-imperfect-tests.html#cb42-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">Sp_PAG=</span><span class="fl">0.50</span>)</span>
<span id="cb42-19"><a href="comparing-2-imperfect-tests.html#cb42-19" aria-hidden="true" tabindex="-1"></a>              )</span></code></pre></div>
<p>Now we can run the model using <code>jags()</code> function.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="comparing-2-imperfect-tests.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(R2jags)</span>
<span id="cb43-2"><a href="comparing-2-imperfect-tests.html#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(coda)</span>
<span id="cb43-3"><a href="comparing-2-imperfect-tests.html#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="comparing-2-imperfect-tests.html#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Run the Bayesian model</span></span>
<span id="cb43-5"><a href="comparing-2-imperfect-tests.html#cb43-5" aria-hidden="true" tabindex="-1"></a>bug.out <span class="ot">&lt;-</span> <span class="fu">jags</span>(<span class="at">data=</span>datalist,                             </span>
<span id="cb43-6"><a href="comparing-2-imperfect-tests.html#cb43-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">model.file=</span><span class="st">&quot;model_2tests_1pop_indep.txt&quot;</span>,     </span>
<span id="cb43-7"><a href="comparing-2-imperfect-tests.html#cb43-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">parameters.to.save=</span><span class="fu">c</span>(<span class="st">&quot;Prev&quot;</span>, <span class="st">&quot;Se_US&quot;</span>, <span class="st">&quot;Sp_US&quot;</span>, <span class="st">&quot;Se_PAG&quot;</span>, <span class="st">&quot;Sp_PAG&quot;</span>),               </span>
<span id="cb43-8"><a href="comparing-2-imperfect-tests.html#cb43-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">n.chains=</span><span class="dv">3</span>,                                 </span>
<span id="cb43-9"><a href="comparing-2-imperfect-tests.html#cb43-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">inits=</span>inits,                                </span>
<span id="cb43-10"><a href="comparing-2-imperfect-tests.html#cb43-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">n.iter=</span><span class="dv">11000</span>,                                </span>
<span id="cb43-11"><a href="comparing-2-imperfect-tests.html#cb43-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">n.burnin=</span><span class="dv">1000</span>,                              </span>
<span id="cb43-12"><a href="comparing-2-imperfect-tests.html#cb43-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">n.thin=</span><span class="dv">1</span>,                                   </span>
<span id="cb43-13"><a href="comparing-2-imperfect-tests.html#cb43-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">DIC=</span><span class="cn">FALSE</span>)                                   </span></code></pre></div>
<pre><code>## Compiling model graph
##    Resolving undeclared variables
##    Allocating nodes
## Graph information:
##    Observed stochastic nodes: 1
##    Unobserved stochastic nodes: 5
##    Total graph size: 40
## 
## Initializing model</code></pre>
<p>Then we could produce the diagnostic plots, compute the ESS, and print out our results as we did previously.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="comparing-2-imperfect-tests.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mcmcplots)</span>
<span id="cb45-2"><a href="comparing-2-imperfect-tests.html#cb45-2" aria-hidden="true" tabindex="-1"></a>bug.mcmc <span class="ot">&lt;-</span> <span class="fu">as.mcmc</span>(bug.out)          </span>
<span id="cb45-3"><a href="comparing-2-imperfect-tests.html#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmcplot</span>(bug.mcmc, <span class="at">title=</span><span class="st">&quot;Diagnostic plots&quot;</span>) </span>
<span id="cb45-4"><a href="comparing-2-imperfect-tests.html#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="fu">effectiveSize</span>(bug.mcmc)</span>
<span id="cb45-5"><a href="comparing-2-imperfect-tests.html#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(bug.out, <span class="at">digits.summary=</span><span class="dv">3</span>) </span></code></pre></div>
<p>Or I could ask to plot the prior and posterior distributions of one (or many) of the parameters.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="comparing-2-imperfect-tests.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot the posterior distribution</span></span>
<span id="cb46-2"><a href="comparing-2-imperfect-tests.html#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(<span class="at">x=</span>bug.out<span class="sc">$</span>BUGSoutput<span class="sc">$</span>sims.list<span class="sc">$</span>Se_US),      </span>
<span id="cb46-3"><a href="comparing-2-imperfect-tests.html#cb46-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;US sensitivity&quot;</span>,                         </span>
<span id="cb46-4"><a href="comparing-2-imperfect-tests.html#cb46-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;Sensitivity&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;Density&quot;</span>,                </span>
<span id="cb46-5"><a href="comparing-2-imperfect-tests.html#cb46-5" aria-hidden="true" tabindex="-1"></a>     )</span>
<span id="cb46-6"><a href="comparing-2-imperfect-tests.html#cb46-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-7"><a href="comparing-2-imperfect-tests.html#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="co">#plot the prior distribution</span></span>
<span id="cb46-8"><a href="comparing-2-imperfect-tests.html#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dbeta</span>(x, <span class="at">shape1=</span>Se.TestA.shapea, <span class="at">shape2=</span>Se.TestA.shapeb), <span class="at">from=</span><span class="dv">0</span>, <span class="at">to=</span><span class="dv">1</span>,          </span>
<span id="cb46-9"><a href="comparing-2-imperfect-tests.html#cb46-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">lty=</span><span class="dv">2</span>,                                                                   </span>
<span id="cb46-10"><a href="comparing-2-imperfect-tests.html#cb46-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">col=</span><span class="st">&quot;red&quot;</span>,                                                                </span>
<span id="cb46-11"><a href="comparing-2-imperfect-tests.html#cb46-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">add=</span><span class="cn">TRUE</span>)                                                                </span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-37"></span>
<img src="_main_files/figure-html/unnamed-chunk-37-1.png" alt="Prior (dashed red line) and posterior (full black line) distribution of US sensitivity." width="672" />
<p class="caption">
Figure 5.1: Prior (dashed red line) and posterior (full black line) distribution of US sensitivity.
</p>
</div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="exercise-1---proportions.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/04-Two_tests.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
